<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Binary format of the negative number for serial device programming - vfxware</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="./binary-format-of-the-negative-number-for-serial-device-programming.html">

        <meta name="author" content="Jianming" />
        <meta name="keywords" content="Serial,Python,Pyserial" />
        <meta name="description" content="When I happens to program for a step motor controller, I found it uses positive/negative number formatted in 4 bytes to represent the rotating step number with the direction. In the manual it says the the device checks if the highest bit is 1, then the 4 bytes value ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.slate.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/monokai.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./extra/custom.css" rel="stylesheet">


</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
vfxware            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/about.html">
                             About
                          </a></li>
                         <li><a href="./pages/contact.html">
                             Contact
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="./archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./binary-format-of-the-negative-number-for-serial-device-programming.html"
                       rel="bookmark"
                       title="Permalink to Binary format of the negative number for serial device programming">
                        Binary format of the negative number for serial device programming
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-12-28T00:00:00+08:00"> Sun 28 December 2014</time>
    </span>
            <span class="label label-default">By</span>
            <a href="./author/jianming.html"><i class="fa fa-user"></i> Jianming</a>

        <span class="label label-default">Category</span>
        <a href="./category/programming.html">Programming</a>


<span class="label label-default">Tags</span>
	<a href="./tag/serial.html">Serial</a>
        /
	<a href="./tag/python.html">Python</a>
        /
	<a href="./tag/pyserial.html">Pyserial</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>When I happens to program for a step motor controller, I found it uses positive/negative number formatted in 4 bytes to represent the rotating step number with the direction. In the manual it says the the device checks if the highest bit is 1, then the 4 bytes value represent a 31 bits available negative direction step number. However this is really about the signed number representations rather than check the highest bit.</p>
<h3>Signed number representation</h3>
<p>In the current programming education, there is less and less mention about the fundemental computer science feature such as the number representation, altough sometimes they talk about it, they don't tell why it is like this. Actually, there is the detailed explaination <a href="http://en.wikipedia.org/wiki/Signed_number_representations">here</a> about the signed number representation. Almost all recent processors use the <em>Two's complement</em>.In short, 127 is 01111111, -128 is 10000000, -1 is 11111111.</p>
<p>Since the serial device only receives the raw bytes, in python we can learn it from:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;b&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">)</span>
</pre></div>


<p>This returns '\x80' which is 0x80 in hex, 10000000 in binary.
Note: here we used '&gt;b' means pack the value -128 into big-endian signed char (1 byte integer).</p>
<div class="highlight"><pre><span></span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;b&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>This returns '\xff' which is 0xFF in hex, 11111111 in binary.</p>
<p>Usually we send just raw byte strings to a serial device, they are actually bunch of 0 and 1 serial commands. So that if my motor controller takes -2500 as revers rotate 2500 steps. We send a 4-byte string,</p>
<div class="highlight"><pre><span></span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;i&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2500</span><span class="p">)</span>
</pre></div>


<p>which is '\xff\xff\xf6\x3c'. Sometimes the pack command returns the string in ASCII because Python's default encoding is 'ascii' encoding. To clearify what exactly the command returns, one can use <code class="python">pack('&gt;i', -2500).encode('hex')</code>. Or I have a more complex solution like, <code class="python">''.join(r'\x%02X' % ord(ch) for ch in src)</code>.</p>
<h3>Compose signed number byte</h3>
<p>Except using struct.pack, we can compose the byte by ourselves easily. For example we know there will be 2500 steps backwards on the serial controller. We can simply generate the bytes with <code>result = 0xFFFFFFFF - 2500 + 1</code>, then pack this byte into string. It is actually <code>result = ~2500 + 1</code>, a bitwise reverse and plus one. To pack this without struct, we can use <code>chr(int(hex(src),16))</code> for a single byte.</p>
<h3>Determine if a variable is signed or not</h3>
<p>Sometimes we still queries to the serial device about the motor position, then how to judge the returned number is signed or not? </p>
<p>The answer is no, we cannot know if it is signed or not just with the value. We have to know the protocol used in the device to tell you whether there is MSB (Most Significan Bit) prepared for this. </p>
<p>However if programming with C not for the serial device. There is a C macro,</p>
<div class="highlight"><pre><span></span><span class="cp">#define ISUNSIGNED(a) (a&gt;=0 &amp;&amp; ~a&gt;=0)</span>
</pre></div>


<p>This one can judge a variable is signed or not to a certain extent. This however still fails for example at a circumstance of promoting unsigned char to int on some of the compiler. There are links about this problem <a href="http://stackoverflow.com/questions/7316862/how-to-determine-whether-a-variable-is-unsigned-or-not-in-ansi-c">here</a> and <a href="http://stackoverflow.com/questions/7469915/value-vs-type-code-to-determine-if-a-variable-is-signed-or-not">here</a>. </p>
<h3>Reference</h3>
<ol>
<li><a href="https://docs.python.org/2/library/struct.html">Python Struct documentation</a></li>
<li><a href="http://en.wikipedia.org/wiki/Signed_number_representations">Wikipedia</a></li>
</ol>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'vfxware'; // required: replace example with your forum shortname

                    var disqus_identifier = 'binary-format-of-the-negative-number-for-serial-device-programming';
                var disqus_url = './binary-format-of-the-negative-number-for-serial-device-programming.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="weixin://contacts/profile/tomriddle_jianming"><i class="fa fa-wechat-square fa-lg"></i> WeChat</a></li>
                <li class="list-group-item"><a href="https://bitbucket.org/jianming_tom"><i class="fa fa-bitbucket-square fa-lg"></i> bitBucket</a></li>
                <li class="list-group-item"><a href="https://github.com/tomriddle1234"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
              </ul>
            </li>

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="./cuda-65-starter-example-with-timing-and-unified-memory-access.html">
                            CUDA 6.5 starter example with timing and Unified Memory access.
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="./new-book-found-computer-vision-for-visual-effects.html">
                            New book found, Computer Vision for Visual Effects
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="./binary-format-of-the-negative-number-for-serial-device-programming.html">
                            Binary format of the negative number for serial device programming
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="./hello-world-pelican.html">
                            Hello World, pelican!
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="./"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="./category/programming.html">
                            <i class="fa fa-folder-open fa-lg"></i> Programming
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="./category/study.html">
                            <i class="fa fa-folder-open fa-lg"></i> Study
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="./category/web.html">
                            <i class="fa fa-folder-open fa-lg"></i> web
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="./"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                </ul>
            </li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://opencv.org/" target="_blank">
                OpenCV
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Jianming
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <script src="./theme/js/bodypadding.js"></script>
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vfxware'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
</body>
</html>